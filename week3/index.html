<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>test</title>
    <style type="text/css">
        .map {
            padding: 0;
            margin: 0;
        }
        
        .row {
            height: 31px;
        }
        
        .cell {
            display: inline-block;
            height: 30px;
            width: 30px;
            border: 1px solid black;
        }
        
        .map img {
            height: 30px;
            width: 30px;
        }
    </style>
</head>

<body>
    <div class="map"></div>
    <div class="intro"></div>


    <script>
        const MAP_SIZE = {
            height: 10,
            length: 10
        };
        const BONUS_COUNT = 10;
        const BONUS_SCORE = 10;

        const initMap = (size, count, score) => { //初始化地图
            const map = [];
            const bonusRecord = initBonus(size, count);
            console.log(bonusRecord); //tip
            for (let row = 0; row < size.height; row++) {
                const rowItem = [];
                for (let col = 0; col < size.length; col++) {
                    if (!isInRecord([row, col], bonusRecord)) {
                        rowItem.push(null);
                        console.log('2');
                        continue;
                    }
                    rowItem.push({
                        bonus: score
                    })
                }
                map.push(rowItem)
            }
            return map;
        }

        const initBonus = (size, count) => {
            const record = [];
            while (record.length < count) {
                const row = Math.floor(Math.random() * size.height);
                const col = Math.floor(Math.random() * size.length);
                if ((row == 0 && col == 0) || isInRecord([row, col], record)) {
                    continue;
                }
                record.push([row, col]);
            }
            return record;
        }

        const isInRecord = (position, record) => {
            for (let i = 0; i < record.length; i++) {
                if ((position[0] == record[i][0]) && (position[1] == record[i][1])) {
                    return true;
                }
            }
            return false;
        }

        const drawMap = (map) => { //绘制地图
            const mapContainer = document.getElementsByClassName('map')[0];
            mapContainer.innerHTML = '';
            for (let i = 0; i < map.length; i++) {
                const oRow = document.createElement('div');
                oRow.className = 'row';
                for (let j = 0; j < map[0].length; j++) {
                    const oCell = document.createElement('div');
                    oCell.className = 'cell';
                    //这里需要对是否有图片做一个判断if…插入图片
                    if (map[i][j] != null) {
                        const oImage = document.createElement('img');
                        oImage.class = 'soy';
                        oImage.src = '1.png';
                        oCell.appendChild(oImage);
                    }
                    oRow.appendChild(oCell);
                }
                mapContainer.appendChild(oRow);
            }
            console.log('行数' + map.length)
            console.log('列数' + map[1].length)
        }

        //move 是一个高阶函数，这种形式也叫柯里化
        //move 这个函数用来根据键盘事件，如上下左右，控制角色移动
        //并根据移动到的单元格信息，来判断分数，以及游戏状态等…
        const move = timer => ev => {

        }


        const main = async() => { //这是什么？？？
            map = initMap(MAP_SIZE, BONUS_COUNT, BONUS_SCORE);
            console.log(map)
                //await loadImages()
            drawMap(map)
        }

        main();
    </script>
</body>

</html>